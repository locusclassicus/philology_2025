<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Распознавание изображений – Программирование на R для филологов</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./regex.html" rel="next">
<link href="./tabular.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Поиск не дал результатов",
    "search-matching-documents-text": "Результаты поиска",
    "search-copy-link-title": "Скопировать ссылку",
    "search-hide-matches-text": "Скрыть дополнительные результаты",
    "search-more-match-text": "дополнительный результат в этом документе",
    "search-more-matches-text": "дополнительных результата(-ов) в этом документе",
    "search-clear-button-title": "Очистить",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Отменить",
    "search-submit-button-title": "Найти",
    "search-label": "Поиск"
  }
}</script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<link rel="stylesheet" href="include/webex.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключить боковую панель навигации" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ocr.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Распознавание изображений</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключить боковую панель навигации" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Поиск" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Программирование на R для филологов</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Поиск"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Введение</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Начало работы</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tabular.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Табличные данные. Анализ датасета</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ocr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Распознавание изображений</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Нормализация. Регулярные выражения</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./xml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Разметка XML</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tei.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Разметка TEI</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./llm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Добавление разметки с LLM</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./share.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Публикационная система Quarto</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Содержание</h2>
   
  <ul>
  <li><a href="#что-такое-ocr-и-tesseract" id="toc-что-такое-ocr-и-tesseract" class="nav-link active" data-scroll-target="#что-такое-ocr-и-tesseract"><span class="header-section-number">3.1</span> Что такое OCR и tesseract</a></li>
  <li><a href="#данные" id="toc-данные" class="nav-link" data-scroll-target="#данные"><span class="header-section-number">3.2</span> Данные</a></li>
  <li><a href="#выбор-страниц" id="toc-выбор-страниц" class="nav-link" data-scroll-target="#выбор-страниц"><span class="header-section-number">3.3</span> Выбор страниц</a></li>
  <li><a href="#извлечение-текста-из-pdf" id="toc-извлечение-текста-из-pdf" class="nav-link" data-scroll-target="#извлечение-текста-из-pdf"><span class="header-section-number">3.4</span> Извлечение текста из pdf</a></li>
  <li><a href="#распознавание" id="toc-распознавание" class="nav-link" data-scroll-target="#распознавание"><span class="header-section-number">3.5</span> Распознавание</a></li>
  <li><a href="#файн-тюнинг" id="toc-файн-тюнинг" class="nav-link" data-scroll-target="#файн-тюнинг"><span class="header-section-number">3.6</span> Файн-тюнинг</a>
  <ul class="collapse">
  <li><a href="#подготовка-изображений" id="toc-подготовка-изображений" class="nav-link" data-scroll-target="#подготовка-изображений"><span class="header-section-number">3.6.1</span> Подготовка изображений</a></li>
  <li><a href="#текстовые-файлы" id="toc-текстовые-файлы" class="nav-link" data-scroll-target="#текстовые-файлы"><span class="header-section-number">3.6.2</span> Текстовые файлы</a></li>
  <li><a href="#дообучение" id="toc-дообучение" class="nav-link" data-scroll-target="#дообучение"><span class="header-section-number">3.6.3</span> Дообучение</a></li>
  <li><a href="#установка-модели" id="toc-установка-модели" class="nav-link" data-scroll-target="#установка-модели"><span class="header-section-number">3.6.4</span> Установка модели</a></li>
  </ul></li>
  <li><a href="#видео-к-этому-уроку" id="toc-видео-к-этому-уроку" class="nav-link" data-scroll-target="#видео-к-этому-уроку"><span class="header-section-number">3.7</span> Видео к этому уроку</a></li>
  <li><a href="#домашнее-задание" id="toc-домашнее-задание" class="nav-link" data-scroll-target="#домашнее-задание"><span class="header-section-number">3.8</span> Домашнее задание</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Распознавание изображений</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>В этом уроке мы освоим основной инструмент для распознавания печатного текста в R – пакет <code>tesseract</code>, а также научимся дообучать модели под конкретные задачи и шрифты. Для работы нам понадобятся следующие библиотеки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qpdf)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tesseract)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdftools)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using poppler version 23.04.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("remotes")</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"arcruz0/tesseractgt"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using GitHub PAT from the git credential store.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Skipping install of 'tesseractgt' from a github remote, the SHA1 (dc49152a) has not changed since last install.
  Use `force = TRUE` to force installation</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tesseractgt)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="что-такое-ocr-и-tesseract" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="что-такое-ocr-и-tesseract"><span class="header-section-number">3.1</span> Что такое OCR и tesseract</h2>
<p>OCR (Optical Character Recognition) — это технология автоматического распознавания печатного текста на изображениях и преобразования его в машинно-читаемый формат. Эта технология позволяет “извлекать” текст из сканированных документов, фотографий, PDF-файлов и других графических форматов.</p>
<p><a href="https://ru.wikipedia.org/wiki/Tesseract">Tesseract</a> — это одна из самых популярных библиотек OCR с открытым исходным кодом, разработанная компанией Google. Tesseract поддерживает более 100 языков и может работать с различными типами изображений и форматами документов.</p>
<p>Пакет <code>tesseract</code> в R представляет собой обертку для библиотеки Tesseract, которая позволяет:</p>
<ul>
<li>Распознавать текст с изображений различных форматов (PNG, JPEG, TIFF, PDF);</li>
<li>Работать с многостраничными документами;</li>
<li>Использовать предобученные модели для разных языков; (<a href="https://tesseract-ocr.github.io/tessdoc/Data-Files-in-different-versions.html">список</a>);</li>
<li>Настраивать параметры распознавания под конкретные задачи;</li>
<li>Дообучать модели для улучшения качества распознавания специфических шрифтов или типов документов.</li>
</ul>
<p>В отличие от онлайн-сервисов OCR, пакет <code>tesseract</code> работает локально, что обеспечивает:</p>
<ul>
<li>Конфиденциальность — данные не передаются третьим лицам;</li>
<li>Скорость — нет задержек на передачу данных по сети;</li>
<li>Настраиваемость — возможность тонкой настройки под конкретные задачи;</li>
<li>Бесшовную интеграцию с экосистемой R для дальнейшего анализа данных.</li>
</ul>
<p>Однако качество распознавания сильно зависит от качества исходного изображения, типа шрифта, языка документа и правильности настройки параметров. Именно поэтому важно уметь не только использовать готовые модели, но и дообучать их под специфические задачи.</p>
</section>
<section id="данные" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="данные"><span class="header-section-number">3.2</span> Данные</h2>
<p>В качестве упражнения мы возьмем ч. 6 № 6 журнала “Невский зритель” за 1821 г. (<a href="http://lib.pushkinskijdom.ru/Default.aspx?tabid=11373">источник</a>).</p>
<p>Журнал «Невский зритель» издавался в Петербурге ежемесячно с января 1820 г. по июнь 1821 г. Всего вышло 18 книжек журнала, составивших 6 частей. Все они доступны на сайте “Пушкинского дома”.</p>
<blockquote class="blockquote">
<p>Официальным издателем журнала был выпускник Московского университета Иван Матвеевич Сниткин (род. ок. 1792 г.). С января по апрель 1820 г. соиздателем «Невского зрителя» был В. К. Кюхельбекер; намеревался войти в число издателей и К. Ф. Рылеев (1797-1826), активный сотрудник журнала с октября 1820-го по февраль 1821 г. В разное время в журнале печатались произведения Пушкина, Кюхельбекера, Жуковского, Баратынского, Дельвига, а также Рылеева, поместившего в октябрьской книжке 1820 г. острейшую сатиру на Аракчеева «К временщику». (<a href="https://www.gorkilib.ru/events/200-let-zhurnalu-nevskiy-zritel">Источник</a>.)</p>
</blockquote>
</section>
<section id="выбор-страниц" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="выбор-страниц"><span class="header-section-number">3.3</span> Выбор страниц</h2>
<p>Для начала вырежем несколько страниц из pdf. Таким образом вы легко можете делить любые издания на главы, разделы и т.д.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>my_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"../ocr"</span>, <span class="at">pattern =</span> <span class="st">"pdf"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>my_files[<span class="dv">2</span>] <span class="co"># нужный файл</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "../ocr/Невский зритель. 1821. Ч. 6. № 6. Июнь.pdf"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf_subset</span>(<span class="at">input =</span> my_files[<span class="dv">2</span>],</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">output =</span> <span class="st">"../ocr/НЗ1821_6_6[50-51].pdf"</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">pages =</span> <span class="dv">50</span><span class="sc">:</span><span class="dv">51</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="./images/rosalia1.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="./images/rosalia2.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Вопрос
</div>
</div>
<div class="callout-body-container callout-body">
<p>Найдите в метаданных к корпусу русских элегий предположительную фамилию автора.</p>
</div>
</div>
<p>Ответ: <input class="webex-solveme nospaces" size="7" data-answer="[&quot;Бадульф&quot;]">.</p>
</section>
<section id="извлечение-текста-из-pdf" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="извлечение-текста-из-pdf"><span class="header-section-number">3.4</span> Извлечение текста из pdf</h2>
<p>Если вам повезло, то pdf хранит уже распознанный текст.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>text1 <span class="ot">&lt;-</span> <span class="fu">pdf_text</span>(<span class="at">pdf =</span> <span class="st">"../ocr/НЗ1821_6_6[50-51].pdf"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(text1)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ЭЭСЮЭЭЭЭЭСКЮЭЭЭЭЭСЮС»ЭЭЭ&lt;Э&lt;ЗС&gt;Э(ІЭ(99ЭС933 э о э з о з э з э

                   РАЗЛУКА.
                     ( Э л е г і я ,)



Розалія, мой спутникъ неизмѣнный
     На полѣ радостей земныхъ!
Розалія, мой другъ, хранитель несравненный!
Когда я отдохну въ объятіяхъ твоихъ? . •.
Съ тобою горестей душа моя незнаетъ,
И сердцу скорбному не измѣнитъ покой!
Надежда мрачный путь звѣздою озаряетъ,
     И я мирюсь съ враждебною судьбой! . . •
Теперь, за дальними, свирѣпыми морями
  Твой сладкій гласъ не оживитъ меня!
Взойдетъ заря надъ злачными холмами,
  Появится въ лучахъ свѣтило дня —
  Напрасно! все кругомъ покрыто мглою.
  Неслышится мнѣ сладкій ігівой привѣтъ.
  Всѣ радости, надежды всѣ съ тобою —
     И опустѣлъ безъ милой свѣтъ!
Подруга милая, скажи, что край прелестный,
   Что мирныя, тѣнисты я поля,
Что своенравныя судьбы привѣтъ мнѣ лестный,
     Когда съ тобой въ разлукѣ я.
     Но другъ мои! горесть отл етаетъ
                     243

    На быстрыхъ времени крылахъ,
    И радость сердце посѣщ аетъ. . . .
    Моя надежда — въ небесахъ!. . .
  Когдажъ опять смягченными судьбами
  Я въ радости къ подругѣ понесусь,
Коснусь волшебныхъ струнъ волшебными пер
                                       стами
  И, съ рѣзвою мечтою примирюсь.

                             А, Б   —   фЪ.</code></pre>
</div>
</div>
<p>Текст распознан достаточно хорошо, есть мелкие ошибки, но их можно исправить (о чем речь пойдет в следующем уроке). Если необходимо сохранить извлеченный из pdf текст для дальнейшей работы, это делается так:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(text1, <span class="at">con =</span> <span class="st">"../ocr/rosalia.txt"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="распознавание" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="распознавание"><span class="header-section-number">3.5</span> Распознавание</h2>
<p>Если текст не распознан (притворимся, что так и есть), то можно попробовать распознать при помощи <code>tesseract</code>. Однако есть нюанс: <code>tesseract</code> не знает дореформенного русского. Это значит, что все яти (ѣ), еры (ъ), фиты (Ѳ) и десятеричные и (і) превратятся во что-то странное. А еще трудности бывают с буквой “т”, т.к. в XIX в. ее печатали по-другому.</p>
<p>Проверим. Но прежде всего надо скачать модель для русского языка. Это делается один раз. Кстати, тессеракт способен “читать” тексты на нескольких языках, для этого передаем значение аргументу language так: <code>"rus+deu"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tesseract_download("rus")</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tesseract_info</span>()<span class="sc">$</span>available</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>text2 <span class="ot">&lt;-</span> <span class="fu">pdf_ocr_text</span>(<span class="st">"../ocr/НЗ1821_6_6[50-51].pdf"</span>, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">language =</span> <span class="st">"rus"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Converting page 1 to НЗ1821_6_6[50-51]_1.png... done!
Converting page 2 to НЗ1821_6_6[50-51]_2.png... done!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(text2)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>999939993993999999339993399999939939 9039303939
РАЗЛУКА.
(Элегтя.)
————-
Розамя, мой спушникъь неизмённый
На полЪ радосшей земныхь!
Розал!я, мой другь, хранишель несравненный!
Когда я ошдохну въ объяпияхь швоихъ?...
Съ шобою горестей душа моя незнаеть,
И сердцу скорбному не измЪнить покой!
Надежда мрачный пушь звЪздою озаряепть,
И я мирюсь съ враждебною судьбой!...
’Геперь, за дальними, свиофпыми морями
Твой сладк!й гласъ не оживишьъ меня!
Взойдеть заря надъ злачными холмами,
Появишся въ лучахъ свЪшило дня —
Напрасно! все кругомъ покрыпю мглою.
Неслышишся мнЪ сладюй тивой привЪфить,
ВсЪ5 радосши, надежды всЪ съ шобою —
И опусш$ль безъ милой свЪзить’
Подруга милая, скажи, чшо край прелесшный,
Чпо мирвыя, тифвисптыя поля,
Чтпо своенравныя судьбы привЪтьъ мн лесшный,
Когда съ шобой въ разлук я.
Но другь мой! горесмь ошленаепть
 245
На бысшрыхь времени крылахь,
И радосшь сердце посфщаеть....
Моя надежда — въ небесахь!...
Когдажъ опяшь смягченными судьбами
Я въ радосши къ подругЪ понесусь,
Коснусь волшебныхь сшрунь волшебными пер-
сшами
И, сь рфзвою мечтшою примирюсь.
Я, Б — $5.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting page 1 to НЗ1821_6_6[50-51]_1.png... done!</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting page 2 to НЗ1821_6_6[50-51]_2.png... done!</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 999939993993999999339993399999939939 9039303939</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># РАЗЛУКА.</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># (Элегтя.)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ————-</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Розамя, мой спушникъь неизмённый</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># На полЪ радосшей земныхь!</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Розал!я, мой другь, хранишель несравненный!</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Когда я ошдохну въ объяпияхь швоихъ?...</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Съ шобою горестей душа моя незнаеть,</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># И сердцу скорбному не измЪнить покой!</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Надежда мрачный пушь звЪздою озаряепть,</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co"># И я мирюсь съ враждебною судьбой!...</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ’Геперь, за дальними, свиофпыми морями</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Твой сладк!й гласъ не оживишьъ меня!</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Взойдеть заря надъ злачными холмами,</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Появишся въ лучахъ свЪшило дня —</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Напрасно! все кругомъ покрыпю мглою.</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Неслышишся мнЪ сладюй тивой привЪфить,</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ВсЪ5 радосши, надежды всЪ съ шобою —</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co"># И опусш$ль безъ милой свЪзить’</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Подруга милая, скажи, чшо край прелесшный,</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Чпо мирвыя, тифвисптыя поля,</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Чтпо своенравныя судьбы привЪтьъ мн лесшный,</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Когда съ шобой въ разлук я.</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Но другь мой! горесмь ошленаепть</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="co">#  245</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co"># На бысшрыхь времени крылахь,</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="co"># И радосшь сердце посфщаеть....</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Моя надежда — въ небесахь!...</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Когдажъ опяшь смягченными судьбами</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Я въ радосши къ подругЪ понесусь,</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Коснусь волшебныхь сшрунь волшебными пер-</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="co"># сшами</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="co"># И, сь рфзвою мечтшою примирюсь.</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Я, Б — $5.</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Что в таких случаях делать?</p>
<ul>
<li><p>Первое: проверить, нет ли обученных моделей, которые справятся с вашей задачей. Можно поискать, например, <a href="https://huggingface.co/Serovvans/trocr-prereform-orthography">модели</a> на Hugging Face. Но результат может будет зависеть от того, на каких шрифтах учили модель.</p></li>
<li><p>Второе: обученные модели можно также поискать в <a href="https://sysblok.ru/digital-heritage/transkribus-kak-kompjuternoe-zrenie-pomogaet-perevodit-teksty-sirijskih-mistikov/">Транскрибусе</a> (например, <a href="https://app.transkribus.org/models/public/text/russian-print-xviii-cent">здесь</a> и <a href="https://app.transkribus.org/models/public/text/44358">здесь</a>). Но у Транскрибуса есть ряд ограничений: модели нельзя использовать локально, расширенный функционал платный, и др. Бесплатно можно пользоваться готовыми приложениями; однако сначала pdf придется преобразовать в картинку.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf_convert</span>(<span class="st">"../ocr/НЗ1821_6_6[50-51].pdf"</span>, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">format =</span> <span class="st">"png"</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">dpi =</span> <span class="dv">300</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">pages =</span> <span class="cn">NULL</span>,  <span class="co"># все страницы, или c(1,3,5) для конкретных</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">filenames =</span> <span class="cn">NULL</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Наконец, можно дообучить уже существующую модель <code>tesseract</code>, как показано вот в этом <a href="https://arcruz0.github.io/posts/finetuning-tess/index.html">примере</a>. Этим мы сейчас и займемся.</li>
</ul>
</section>
<section id="файн-тюнинг" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="файн-тюнинг"><span class="header-section-number">3.6</span> Файн-тюнинг</h2>
<p>Начиная с версии 4, Tesseract использует нейронную сеть для распознавания текста, что позволяет дообучать модель для конкретных задач. Для дообучения необходимы эталонные данные — фрагменты изображений с соответствующим им текстом.</p>
<section id="подготовка-изображений" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="подготовка-изображений"><span class="header-section-number">3.6.1</span> Подготовка изображений</h3>
<p>Создайте папку с именем <code>{язык}-ground-truth/</code> (например, <code>orus-ground-truth/</code>) и поместите туда изображения текста. Названия файлов могут быть любыми. Самый простой способ: сделать скриншоты вручную (чем больше, тем лучше). Вот пример:</p>
<p><img src="images/ground_truth1.png" class="img-fluid"></p>
<p>Более продвинутый подход к нарезке изображений можно найти <a href="https://github.com/ukolshurika/finetune-ocr-sample">здесь</a> (для Python). Мы нарежем изображение на отдельные слова в R. Для этого скачайте следующий <a href="https://github.com/locusclassicus/philology_2025/blob/main/helper_scripts/crop_words.R">скрипт</a> и запустите его:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../helper_scripts/crop_words.R"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>В глобальном окружении появится функция <code>crop_words()</code>. Она принимает на входе путь до изображения (обязательный аргумент), название директории, куда будут сохранены слова (по умолчанию <code>words</code>), язык базовой модели (код <code>tesseract</code>, по умолчанию <code>rus</code>) и отступ вокруг слова при обрезке (в пикселях). Аргумент <code>overwrite</code> управляет тем, очищать ли существующие файлы <code>word_*.png</code> в <code>out_dir</code> перед сохранением (по умолчанию <code>FALSE</code>).</p>
<p>Также функция проверяет наличие пакетов <code>magick</code>, <code>tesseract</code>, <code>tidyverse</code>; при отсутствии пытается установить их вместе с зависимостями и затем подключает. Для корректной работы OCR с выбранным языком в системе должны быть установлены языковые данные Tesseract.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crop_words</span>(<span class="at">image_path =</span> <span class="st">"../ocr/НЗ1821_6_6[50-51]_1.png"</span>,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">out_dir =</span> <span class="st">"../ocr/words"</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">lang =</span> <span class="st">"rus"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">pad =</span> <span class="dv">2</span>L,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">overwrite =</span> <span class="cn">FALSE</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["file"],"name":[1],"type":["chr"],"align":["left"]},{"label":["word"],"name":[2],"type":["chr"],"align":["left"]},{"label":["confidence"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["x1"],"name":[4],"type":["int"],"align":["right"]},{"label":["y1"],"name":[5],"type":["int"],"align":["right"]},{"label":["x2"],"name":[6],"type":["int"],"align":["right"]},{"label":["y2"],"name":[7],"type":["int"],"align":["right"]},{"label":["w"],"name":[8],"type":["int"],"align":["right"]},{"label":["h"],"name":[9],"type":["int"],"align":["right"]}],"data":[{"1":"../ocr/words/word_473.png","2":"99999993993990999033999330990890009389","3":"0.000000","4":"116","5":"159","6":"1192","7":"199","8":"1076","9":"40"},{"1":"../ocr/words/word_474.png","2":"030300089","3":"72.276497","4":"977","5":"143","6":"1194","7":"205","8":"217","9":"62"},{"1":"../ocr/words/word_475.png","2":"РАЗЛУКА.","3":"89.449821","4":"465","5":"379","6":"852","7":"431","8":"387","9":"52"},{"1":"../ocr/words/word_476.png","2":"(Элеггя.)","3":"73.920197","4":"498","5":"466","6":"813","7":"534","8":"315","9":"68"},{"1":"../ocr/words/word_477.png","2":"———--","3":"35.957916","4":"489","5":"580","6":"778","7":"598","8":"289","9":"18"},{"1":"../ocr/words/word_478.png","2":"Розамя,","3":"72.158585","4":"116","5":"684","6":"294","7":"730","8":"178","9":"46"},{"1":"../ocr/words/word_479.png","2":"мой","3":"93.202614","4":"318","5":"683","6":"401","7":"718","8":"83","9":"35"},{"1":"../ocr/words/word_480.png","2":"спушникь","3":"91.126488","4":"425","5":"693","6":"636","7":"730","8":"211","9":"37"},{"1":"../ocr/words/word_481.png","2":"неизмнный","3":"36.172585","4":"659","5":"684","6":"927","7":"721","8":"268","9":"37"},{"1":"../ocr/words/word_482.png","2":"На","3":"96.812431","4":"226","5":"749","6":"285","7":"783","8":"59","9":"34"},{"1":"../ocr/words/word_483.png","2":"пол","3":"8.809959","4":"307","5":"748","6":"407","7":"781","8":"100","9":"33"},{"1":"../ocr/words/word_484.png","2":"радосшей","3":"92.446777","4":"433","5":"747","6":"637","7":"792","8":"204","9":"45"},{"1":"../ocr/words/word_485.png","2":"земныхь!","3":"89.286819","4":"662","5":"742","6":"859","7":"783","8":"197","9":"41"},{"1":"../ocr/words/word_486.png","2":"Розал1я,","3":"40.524731","4":"116","5":"808","6":"289","7":"854","8":"173","9":"46"},{"1":"../ocr/words/word_487.png","2":"мой","3":"92.734200","4":"313","5":"807","6":"396","7":"843","8":"83","9":"36"},{"1":"../ocr/words/word_488.png","2":"другь,","3":"35.922058","4":"419","5":"818","6":"550","7":"856","8":"131","9":"38"},{"1":"../ocr/words/word_489.png","2":"хранишель","3":"91.904892","4":"574","5":"818","6":"808","7":"856","8":"234","9":"38"},{"1":"../ocr/words/word_490.png","2":"несравненный!","3":"91.789505","4":"832","5":"803","6":"1146","7":"857","8":"314","9":"54"},{"1":"../ocr/words/word_491.png","2":"Когда","3":"96.021118","4":"118","5":"875","6":"244","7":"916","8":"126","9":"41"},{"1":"../ocr/words/word_492.png","2":"я","3":"93.075470","4":"266","5":"881","6":"293","7":"906","8":"27","9":"25"},{"1":"../ocr/words/word_493.png","2":"ошдохну","3":"92.124016","4":"320","5":"880","6":"501","7":"918","8":"181","9":"38"},{"1":"../ocr/words/word_494.png","2":"въ","3":"91.895859","4":"524","5":"880","6":"572","7":"907","8":"48","9":"27"},{"1":"../ocr/words/word_495.png","2":"объяпияхь","3":"91.491516","4":"596","5":"871","6":"818","7":"908","8":"222","9":"37"},{"1":"../ocr/words/word_496.png","2":"швоихъ?...","3":"86.145630","4":"841","5":"871","6":"1095","7":"911","8":"254","9":"40"},{"1":"../ocr/words/word_497.png","2":"Съ","3":"92.114243","4":"122","5":"936","6":"175","7":"972","8":"53","9":"36"},{"1":"../ocr/words/word_498.png","2":"шобою","3":"92.054810","4":"196","5":"933","6":"340","7":"970","8":"144","9":"37"},{"1":"../ocr/words/word_499.png","2":"горестей","3":"90.776527","4":"364","5":"934","6":"567","7":"981","8":"203","9":"47"},{"1":"../ocr/words/word_500.png","2":"душа","3":"96.543510","4":"590","5":"943","6":"698","7":"980","8":"108","9":"37"},{"1":"../ocr/words/word_501.png","2":"моя","3":"92.468002","4":"723","5":"944","6":"805","7":"969","8":"82","9":"25"},{"1":"../ocr/words/word_502.png","2":"незнаетъ,","3":"71.025726","4":"828","5":"943","6":"1045","7":"978","8":"217","9":"35"},{"1":"../ocr/words/word_503.png","2":"И","3":"79.121040","4":"119","5":"999","6":"156","7":"1033","8":"37","9":"34"},{"1":"../ocr/words/word_504.png","2":"сердцу","3":"93.275284","4":"179","5":"1005","6":"324","7":"1042","8":"145","9":"37"},{"1":"../ocr/words/word_505.png","2":"скорбному","3":"90.260010","4":"348","5":"994","6":"572","7":"1042","8":"224","9":"48"},{"1":"../ocr/words/word_506.png","2":"не","3":"93.239830","4":"595","5":"1004","6":"644","7":"1031","8":"49","9":"27"},{"1":"../ocr/words/word_507.png","2":"измЪнить","3":"31.404068","4":"670","5":"999","6":"890","7":"1031","8":"220","9":"32"},{"1":"../ocr/words/word_508.png","2":"покой!","3":"96.369286","4":"913","5":"991","6":"1050","7":"1032","8":"137","9":"41"},{"1":"../ocr/words/word_509.png","2":"Надежда","3":"96.366859","4":"118","5":"1061","6":"299","7":"1103","8":"181","9":"42"},{"1":"../ocr/words/word_510.png","2":"мрачный","3":"93.274780","4":"310","5":"1057","6":"502","7":"1104","8":"192","9":"47"},{"1":"../ocr/words/word_511.png","2":"пушь","3":"86.219391","4":"527","5":"1068","6":"638","7":"1103","8":"111","9":"35"},{"1":"../ocr/words/word_512.png","2":"звЪздою","3":"84.107109","4":"664","5":"1060","6":"833","7":"1100","8":"169","9":"40"},{"1":"../ocr/words/word_513.png","2":"озаряелть,","3":"75.770386","4":"858","5":"1067","6":"1077","7":"1105","8":"219","9":"38"},{"1":"../ocr/words/word_514.png","2":"И","3":"94.618698","4":"226","5":"1122","6":"262","7":"1156","8":"36","9":"34"},{"1":"../ocr/words/word_515.png","2":"я","3":"90.982246","4":"287","5":"1129","6":"315","7":"1155","8":"28","9":"26"},{"1":"../ocr/words/word_516.png","2":"мирюсь","3":"90.228455","4":"337","5":"1128","6":"501","7":"1166","8":"164","9":"38"},{"1":"../ocr/words/word_517.png","2":"съ","3":"93.206764","4":"525","5":"1129","6":"573","7":"1155","8":"48","9":"26"},{"1":"../ocr/words/word_518.png","2":"враждебною","3":"90.463013","4":"597","5":"1118","6":"854","7":"1165","8":"257","9":"47"},{"1":"../ocr/words/word_519.png","2":"судьбой!...","3":"90.463013","4":"887","5":"1114","6":"1145","7":"1166","8":"258","9":"52"},{"1":"../ocr/words/word_520.png","2":"Теперь,","3":"49.824013","4":"119","5":"1185","6":"286","7":"1229","8":"167","9":"44"},{"1":"../ocr/words/word_521.png","2":"за","3":"96.635040","4":"312","5":"1189","6":"359","7":"1217","8":"47","9":"28"},{"1":"../ocr/words/word_522.png","2":"дальними,","3":"90.601212","4":"382","5":"1190","6":"596","7":"1225","8":"214","9":"35"},{"1":"../ocr/words/word_523.png","2":"свирЪпыми","3":"61.556290","4":"623","5":"1184","6":"864","7":"1227","8":"241","9":"43"},{"1":"../ocr/words/word_524.png","2":"морями","3":"96.331825","4":"890","5":"1191","6":"1057","7":"1228","8":"167","9":"37"},{"1":"../ocr/words/word_525.png","2":"Твой","3":"92.776001","4":"169","5":"1244","6":"276","7":"1281","8":"107","9":"37"},{"1":"../ocr/words/word_526.png","2":"сладк!й","3":"66.009987","4":"299","5":"1242","6":"455","7":"1286","8":"156","9":"44"},{"1":"../ocr/words/word_527.png","2":"гласъь","3":"58.066563","4":"479","5":"1253","6":"592","7":"1279","8":"113","9":"26"},{"1":"../ocr/words/word_528.png","2":"не","3":"93.225449","4":"616","5":"1252","6":"665","7":"1278","8":"49","9":"26"},{"1":"../ocr/words/word_529.png","2":"оживишь","3":"90.286278","4":"690","5":"1253","6":"888","7":"1278","8":"198","9":"25"},{"1":"../ocr/words/word_530.png","2":"меня!","3":"95.892982","4":"912","5":"1237","6":"1040","7":"1279","8":"128","9":"42"},{"1":"../ocr/words/word_531.png","2":"Взойдешь","3":"54.734921","4":"120","5":"1307","6":"326","7":"1351","8":"206","9":"44"},{"1":"../ocr/words/word_532.png","2":"заря","3":"93.113075","4":"350","5":"1314","6":"447","7":"1351","8":"97","9":"37"},{"1":"../ocr/words/word_533.png","2":"надъ","3":"90.497810","4":"471","5":"1314","6":"565","7":"1348","8":"94","9":"34"},{"1":"../ocr/words/word_534.png","2":"злачными","3":"90.497810","4":"589","5":"1314","6":"799","7":"1340","8":"210","9":"26"},{"1":"../ocr/words/word_535.png","2":"холмами,","3":"94.974220","4":"825","5":"1314","6":"1024","7":"1350","8":"199","9":"36"},{"1":"../ocr/words/word_536.png","2":"Появишся","3":"91.433929","4":"172","5":"1371","6":"393","7":"1405","8":"221","9":"34"},{"1":"../ocr/words/word_537.png","2":"въ","3":"93.081566","4":"414","5":"1377","6":"462","7":"1401","8":"48","9":"24"},{"1":"../ocr/words/word_538.png","2":"лучахъ","3":"71.227921","4":"484","5":"1375","6":"630","7":"1413","8":"146","9":"38"},{"1":"../ocr/words/word_539.png","2":"свЪъшило","3":"51.437675","4":"655","5":"1370","6":"838","7":"1402","8":"183","9":"32"},{"1":"../ocr/words/word_540.png","2":"дня","3":"93.033081","4":"864","5":"1377","6":"939","7":"1408","8":"75","9":"31"},{"1":"../ocr/words/word_541.png","2":"—","3":"89.299500","4":"963","5":"1384","6":"1005","7":"1394","8":"42","9":"10"},{"1":"../ocr/words/word_542.png","2":"Напрасно!","3":"96.731857","4":"173","5":"1424","6":"390","7":"1475","8":"217","9":"51"},{"1":"../ocr/words/word_543.png","2":"все","3":"91.665321","4":"415","5":"1437","6":"483","7":"1465","8":"68","9":"28"},{"1":"../ocr/words/word_544.png","2":"кругомъ","3":"91.665321","4":"507","5":"1438","6":"681","7":"1475","8":"174","9":"37"},{"1":"../ocr/words/word_545.png","2":"покрыто","3":"75.714066","4":"705","5":"1438","6":"899","7":"1475","8":"194","9":"37"},{"1":"../ocr/words/word_546.png","2":"мглою.","3":"91.196594","4":"924","5":"1438","6":"1072","7":"1464","8":"148","9":"26"},{"1":"../ocr/words/word_547.png","2":"Неслышишся","3":"76.501892","4":"174","5":"1491","6":"463","7":"1526","8":"289","9":"35"},{"1":"../ocr/words/word_548.png","2":"мнЪ","3":"90.979317","4":"485","5":"1494","6":"569","7":"1525","8":"84","9":"31"},{"1":"../ocr/words/word_549.png","2":"сладкй","3":"43.754494","4":"594","5":"1489","6":"747","7":"1533","8":"153","9":"44"},{"1":"../ocr/words/word_550.png","2":"тивой","3":"52.772743","4":"774","5":"1490","6":"885","7":"1525","8":"111","9":"35"},{"1":"../ocr/words/word_551.png","2":"привить.","3":"20.517342","4":"911","5":"1493","6":"1113","7":"1536","8":"202","9":"43"},{"1":"../ocr/words/word_552.png","2":"ВсЪ","3":"30.565521","4":"175","5":"1551","6":"256","7":"1587","8":"81","9":"36"},{"1":"../ocr/words/word_553.png","2":"радосши,","3":"85.947182","4":"281","5":"1559","6":"474","7":"1596","8":"193","9":"37"},{"1":"../ocr/words/word_554.png","2":"надежды","3":"93.204628","4":"500","5":"1560","6":"685","7":"1593","8":"185","9":"33"},{"1":"../ocr/words/word_555.png","2":"всЪ","3":"83.456612","4":"711","5":"1554","6":"783","7":"1586","8":"72","9":"32"},{"1":"../ocr/words/word_556.png","2":"съ","3":"93.272934","4":"808","5":"1561","6":"855","7":"1586","8":"47","9":"25"},{"1":"../ocr/words/word_557.png","2":"шобою","3":"84.540115","4":"880","5":"1550","6":"1023","7":"1587","8":"143","9":"37"},{"1":"../ocr/words/word_558.png","2":"—","3":"92.675232","4":"1045","5":"1568","6":"1087","7":"1579","8":"42","9":"11"},{"1":"../ocr/words/word_559.png","2":"И","3":"91.996384","4":"233","5":"1613","6":"269","7":"1647","8":"36","9":"34"},{"1":"../ocr/words/word_560.png","2":"опусшёль","3":"0.000000","4":"293","5":"1613","6":"499","7":"1656","8":"206","9":"43"},{"1":"../ocr/words/word_561.png","2":"безъ","3":"82.867844","4":"526","5":"1610","6":"618","7":"1645","8":"92","9":"35"},{"1":"../ocr/words/word_562.png","2":"милой","3":"93.060799","4":"643","5":"1612","6":"773","7":"1645","8":"130","9":"33"},{"1":"../ocr/words/word_563.png","2":"свЪшь’","3":"72.797234","4":"799","5":"1606","6":"944","7":"1645","8":"145","9":"39"},{"1":"../ocr/words/word_564.png","2":"Подруга","3":"96.414780","4":"125","5":"1676","6":"300","7":"1722","8":"175","9":"46"},{"1":"../ocr/words/word_565.png","2":"милая,","3":"93.441597","4":"326","5":"1680","6":"470","7":"1715","8":"144","9":"35"},{"1":"../ocr/words/word_566.png","2":"скажи,","3":"95.704521","4":"497","5":"1680","6":"642","7":"1712","8":"145","9":"32"},{"1":"../ocr/words/word_567.png","2":"что","3":"40.864822","4":"671","5":"1680","6":"755","7":"1705","8":"84","9":"25"},{"1":"../ocr/words/word_568.png","2":"край","3":"93.288399","4":"781","5":"1672","6":"879","7":"1716","8":"98","9":"44"},{"1":"../ocr/words/word_569.png","2":"прелесшный,","3":"89.629120","4":"903","5":"1670","6":"1183","7":"1718","8":"280","9":"48"},{"1":"../ocr/words/word_570.png","2":"Чшо","3":"70.131348","4":"179","5":"1738","6":"272","7":"1772","8":"93","9":"34"},{"1":"../ocr/words/word_571.png","2":"мирныя,","3":"77.952911","4":"296","5":"1743","6":"480","7":"1780","8":"184","9":"37"},{"1":"../ocr/words/word_572.png","2":"шфнисптыя","3":"59.341148","4":"506","5":"1735","6":"743","7":"1767","8":"237","9":"32"},{"1":"../ocr/words/word_573.png","2":"поля,","3":"95.183319","4":"766","5":"1741","6":"883","7":"1774","8":"117","9":"33"},{"1":"../ocr/words/word_574.png","2":"Что","3":"80.542992","4":"129","5":"1800","6":"222","7":"1834","8":"93","9":"34"},{"1":"../ocr/words/word_575.png","2":"своенравныя","3":"91.194572","4":"246","5":"1805","6":"519","7":"1843","8":"273","9":"38"},{"1":"../ocr/words/word_576.png","2":"судьбы","3":"92.983963","4":"543","5":"1792","6":"692","7":"1840","8":"149","9":"48"},{"1":"../ocr/words/word_577.png","2":"привЪть","3":"59.552383","4":"704","5":"1797","6":"890","7":"1839","8":"186","9":"42"},{"1":"../ocr/words/word_578.png","2":"мнЪ","3":"85.747452","4":"901","5":"1797","6":"984","7":"1831","8":"83","9":"34"},{"1":"../ocr/words/word_579.png","2":"лесшный,","3":"91.336082","4":"993","5":"1796","6":"1201","7":"1844","8":"208","9":"48"},{"1":"../ocr/words/word_580.png","2":"Когда","3":"94.631355","4":"235","5":"1860","6":"358","7":"1903","8":"123","9":"43"},{"1":"../ocr/words/word_581.png","2":"съ","3":"93.228706","4":"382","5":"1869","6":"429","7":"1896","8":"47","9":"27"},{"1":"../ocr/words/word_582.png","2":"шобой","3":"92.317772","4":"452","5":"1856","6":"589","7":"1893","8":"137","9":"37"},{"1":"../ocr/words/word_583.png","2":"въ","3":"91.869881","4":"614","5":"1866","6":"662","7":"1891","8":"48","9":"25"},{"1":"../ocr/words/word_584.png","2":"разлукЪ","3":"90.995399","4":"685","5":"1859","6":"851","7":"1903","8":"166","9":"44"},{"1":"../ocr/words/word_585.png","2":"я.","3":"96.663788","4":"877","5":"1867","6":"913","7":"1893","8":"36","9":"26"},{"1":"../ocr/words/word_586.png","2":"Но","3":"92.977943","4":"234","5":"1922","6":"294","7":"1957","8":"60","9":"35"},{"1":"../ocr/words/word_587.png","2":"другь","3":"91.907021","4":"317","5":"1930","6":"434","7":"1968","8":"117","9":"38"},{"1":"../ocr/words/word_588.png","2":"мой!","3":"93.287598","4":"458","5":"1914","6":"556","7":"1957","8":"98","9":"43"},{"1":"../ocr/words/word_589.png","2":"горестшь","3":"21.212265","4":"579","5":"1927","6":"755","7":"1969","8":"176","9":"42"},{"1":"../ocr/words/word_590.png","2":"отлешаепть","3":"80.745415","4":"779","5":"1927","6":"1029","7":"1958","8":"250","9":"31"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>После этого в папке <code>words</code> должно появиться нечто похожее:</p>
<p><img src="images/words_view.png" class="img-fluid"> Чтобы “разрезать” на слова <em>несколько</em> изображений, используем функции для итераций из пакета <code>purrr</code> (мы встречались с ними, когда читали сразу несколько текстовых файлов в окружение).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>img_paths <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"../ocr"</span>, <span class="at">pattern =</span> <span class="st">"png"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>img_paths</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "../ocr/НЗ1821_6_6[50-51]_1.png" "../ocr/НЗ1821_6_6[50-51]_2.png"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(img_paths, crop_words, </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">out_dir =</span> <span class="st">"../ocr/orus-ground-truth"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="текстовые-файлы" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="текстовые-файлы"><span class="header-section-number">3.6.2</span> Текстовые файлы</h3>
<p>Теперь для каждого изображения добавим текст (файлы в формате <code>.gt.txt</code>). Для ускорения процесса создания эталонных файлов можно использовать пакет <code>tesseractgt</code>. Для создания таких файлов используем базовую модель.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">create_gt_txt</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">folder =</span> <span class="st">"../ocr/orus-ground-truth"</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">extension =</span> <span class="st">"png"</span>, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">engine =</span> tesseract<span class="sc">::</span><span class="fu">tesseract</span>(<span class="at">language =</span> <span class="st">"rus"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Убедитесь, что файлы появились в директории. Список должен выглядеть примерно так:</p>
<p><img src="images/img_and_text_view.png" class="img-fluid"></p>
<p>Теперь самый важный этап: корректировка текстовых файлов. Исправить автоматически созданные файлы <code>.gt.txt</code> поможет специальная функция:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">correct_gt_txt</span>() </span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://arcruz0.github.io/posts/finetuning-tess/imgs/addin.gif" class="img-fluid figure-img"></p>
<figcaption><a href="https://arcruz0.github.io/posts/finetuning-tess/">Источник</a></figcaption>
</figure>
</div>
<p>Если не видно папки с изображениями, смените рабочую директорию. Вот несколько полезных символов:</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
На заметку
</div>
</div>
<div class="callout-body-container callout-body">
<p>Чаще всего используемые в дореформенной русской орфографии:</p>
<ul>
<li>Ять: Ѣ (U+0462), ѣ (U+0463)</li>
<li>И десятеричное: І (U+0406), і (U+0456)</li>
<li>Фита: Ѳ (U+0472), ѳ (U+0473)</li>
<li>Ижица: Ѵ (U+0474), ѵ (U+0475)</li>
<li>Твёрдый знак, еръ: Ъ (U+042A), ъ (U+044A)</li>
</ul>
</div>
</div>
</section>
<section id="дообучение" class="level3" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="дообучение"><span class="header-section-number">3.6.3</span> Дообучение</h3>
<p>Теперь мы готовы к дообучению модели. Сначала переходим в терминал, клонируем репозиторий <code>tesstrain</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>git clone https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>tesseract<span class="sc">-</span>ocr<span class="sc">/</span>tesstrain.git</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Эта команда скачает репозиторий <code>tesstrain</code> с GitHub. При этом локально создается папка <code>tesstrain</code> со скриптами и <code>Makefile</code> для обучения моделей Tesseract. Скачивание может занять несколько минут.</p>
<p>Теперь переходим в только что созданную папку. Команда смены каталога <code>cd</code> работает и на macOS, и на Windows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>cd tesstrain</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Следующая команда запускает утилиту (небольшую программу) <code>make</code> и выполняет задачу <code>tesseract-langdata</code>, описанную в <code>Makefile</code> проекта. В результате автоматически скачиваются официальные языковые данные Tesseract, необходимые для обучения, а именно <code>langdata</code> и/или <code>langdata_lstm</code> — наборы текстов, списки слов, правила пунктуации/нормализации и прочие файлы, которые используются при подготовке и обучении модели.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>make tesseract<span class="sc">-</span>langdata</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>На этом этапе вы можете столкнуться с ошибкой.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Makefile:175: *** This version of GNU Make is too low (3.81). Check your path, or upgrade to 4.2 or newer..  Stop.</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Проблема решается путем обновления утилиты. На MacOS установить новую GNU Make можно через Homebrew (это менеджер пакетов, его надо отдельно устанавливать: <a href="https://brew.sh/" class="uri">https://brew.sh/</a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># в терминале</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>brew install make</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>После установки появится команда <code>gmake</code>. Её можно вызывать напрямую:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># в терминале, придется подожать</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>gmake tesseract<span class="sc">-</span>langdata</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>На Windows задача также решается при помощи менеджера пакетов – например, Scoop <a href="https://scoop.sh/" class="uri">https://scoop.sh/</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># в терминале</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>scoop install make</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>После установки проверьте версию <code>make</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># в терминале </span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># gmake --version для MacOS</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>make <span class="sc">--</span>version</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Итог: после этих команд у вас есть локальная копия <code>tesstrain</code>, вы находитесь в её каталоге, и в него загружены исходные языковые данные (<code>data</code>), без которых обучение своей модели Tesseract не запустится.</p>
<p>На этом этапе структура каталога выглядит так:</p>
<p>Теперь нам надо переместить обучающие данные – в нашем случае это <code>orus-ground-truth</code> в папку <code>data</code>. Можете просто скопировать вручную.</p>
<p>Все, можно запускать дообучение.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># в терминале, make на Windows</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>gmake training MODEL_NAME<span class="ot">=</span>orus START_MODEL<span class="ot">=</span>rus FINETUNE_TYPE<span class="ot">=</span>Impact LANG_TYPE<span class="ot">=</span>Both</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Команда выше запускает “рецепт” обучения нейросети Tesseract. Этот рецепт под названием <code>training</code> автоматически готовит данные и запускает процесс дообучения модели распознавания текста.</p>
<p>Что означает каждая часть команды:</p>
<ul>
<li><code>gmake training</code> — запустить задание <code>training</code> из файла правил (<code>Makefile</code>). Оно скачает/подготовит данные, запустит обучение и положит результат в папку с моделями.</li>
<li><code>MODEL_NAME=orus</code> — имя новой модели, которую вы хотите получить. В конце появится файл вроде <code>orus.traineddata</code>.</li>
<li><code>START_MODEL=rus</code> — не учить с нуля, а взять за основу существующую русскую модель <code>rus</code> и “докрутить” ее под новые данные. Это быстрее и надежнее.</li>
<li><code>FINETUNE_TYPE=Impact</code> — “бережное” дообучение: меняются только части сети, чтобы сохранить сильные стороны базовой модели и адаптировать её под ваши тексты.</li>
<li><code>LANG_TYPE=Both</code> — использовать оба набора языковых данных Tesseract (классический и LSTM), чтобы шире покрыть правила, словари и примеры.</li>
</ul>
<p>Дообучение занимает несколько минут ☕☕☕</p>
</section>
<section id="установка-модели" class="level3" data-number="3.6.4">
<h3 data-number="3.6.4" class="anchored" data-anchor-id="установка-модели"><span class="header-section-number">3.6.4</span> Установка модели</h3>
<p>Найдите системную папку Tesseract:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>tesseract<span class="sc">::</span><span class="fu">tesseract_info</span>()<span class="sc">$</span>datapath</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "/Users/olga/Library/Application Support/tesseract5/tessdata/"</code></pre>
</div>
</div>
<p>Скопируйте сюда новую модель <code>orus.trainedata</code>, которая должна появиться в папке <code>data</code>.</p>
<p>Проверьте доступные модели:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>tesseract<span class="sc">::</span><span class="fu">tesseract_info</span>()<span class="sc">$</span>available</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "deu"  "eng"  "grc"  "lat"  "orus" "osd"  "rus" </code></pre>
</div>
</div>
<p>Все, после дообучения можем использовать новую модель:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>text3 <span class="ot">&lt;-</span> <span class="fu">pdf_ocr_text</span>(<span class="st">"../ocr/НЗ1821_6_6[50-51].pdf"</span>, <span class="at">language =</span> <span class="st">"orus"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Converting page 1 to НЗ1821_6_6[50-51]_1.png... done!
Converting page 2 to НЗ1821_6_6[50-51]_2.png... done!</code></pre>
</div>
</div>
<p>Таким образом, дообучение Tesseract позволяет улучшить качество распознавания специализированных текстов; для лучшего результата используйте больше обучающих данных (чем больше, тем лучше). Пакет <code>tesseractgt</code> существенно упрощает процесс подготовки обучающих данных.</p>
</section>
</section>
<section id="видео-к-этому-уроку" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="видео-к-этому-уроку"><span class="header-section-number">3.7</span> Видео к этому уроку</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
 _______________________ 
&lt;Будет добавлено позже&gt;
 ----------------------- 
        \
         \

           _,
      -==&lt;' `
          ) /
         / (_.
        |  ,-,`\
         \\   \ \
          `\,  \ \
           ||\  \`|,
 jgs      _|| `=`-'
         ~~`~`</code></pre>
</div>
</div>
</section>
<section id="домашнее-задание" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="домашнее-задание"><span class="header-section-number">3.8</span> Домашнее задание</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
 _______________________ 
&lt;Будет добавлено позже&gt;
 ----------------------- 
    \
     \

       /\___/\
       {o}{o}|
       \ v  /|
       |    \ \
        \___/_/       [ab]
          | |</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Скопировано");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Скопировано");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./tabular.html" class="pagination-link" aria-label="Табличные данные. Анализ датасета">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Табличные данные. Анализ датасета</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./regex.html" class="pagination-link" aria-label="Нормализация. Регулярные выражения">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Нормализация. Регулярные выражения</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>